"use strict";(self.webpackChunktaskforce_frontend=self.webpackChunktaskforce_frontend||[]).push([[585],{585:(e,s,a)=>{a.r(s),a.d(s,{default:()=>f});var t=a(43),i=a(60),r=a(742),l=a(178),n=a(202),c=a(759),o=a(579);const d=e=>{let{projects:s,selectedProject:a,onProjectChange:t}=e;return(0,o.jsxs)("div",{className:"project-selector",children:[(0,o.jsx)("h2",{children:"S\xe9lectionner un projet"}),(0,o.jsxs)("select",{value:(null===a||void 0===a?void 0:a.id)||"",onChange:e=>t(e.target.value?parseInt(e.target.value):null),className:"project-select",children:[(0,o.jsx)("option",{value:"",children:"Choisir un projet..."}),s.map((e=>(0,o.jsx)("option",{value:e.id,children:e.name},e.id)))]})]})},m=e=>{let{projectTasks:s,projectUsers:a,onCreateTask:t,onAddUser:i,onNavigateToDashboard:r}=e;return(0,o.jsx)("div",{className:"overview-tab",children:(0,o.jsx)("div",{className:"overview-grid",children:(0,o.jsxs)("div",{className:"overview-card",children:[(0,o.jsx)("h3",{children:"Chiffres cl\xe9s du projet "}),(0,o.jsxs)("div",{className:"stats",children:[(0,o.jsxs)("div",{className:"stat-item",children:[(0,o.jsx)("span",{className:"stat-number",children:s.length}),(0,o.jsx)("span",{className:"stat-label",children:"T\xe2ches"})]}),(0,o.jsxs)("div",{className:"stat-item",children:[(0,o.jsx)("span",{className:"stat-number",children:a.length}),(0,o.jsx)("span",{className:"stat-label",children:"Utilisateurs"})]})]})]})})})},u=e=>{let{projectTasks:s,onCreateTask:a,onReassignTask:i,onEditTask:r,onShowTaskDetail:l,onDeleteTask:n,currentUserRole:d}=e;const[m,u]=(0,t.useState)(new Set);return(0,o.jsxs)("div",{className:"tasks-tab",children:[(0,o.jsxs)("div",{className:"tab-header",children:[(0,o.jsx)("h3",{children:"Gestion des T\xe2ches"}),(0,o.jsxs)("div",{className:"tab-actions",children:[c.A.canModifyTasks(d)&&(0,o.jsx)("button",{className:"btn-primary",onClick:a,children:"Cr\xe9er une nouvelle t\xe2che"}),c.A.isManager(d)&&(0,o.jsx)("div",{className:"manager-info",children:(0,o.jsx)("span",{className:"info-text",children:"\ud83d\udc41\ufe0f Mode consultation uniquement"})})]})]}),(0,o.jsxs)("div",{className:"project-tasks",children:[(0,o.jsx)("h4",{children:"T\xe2ches du projet"}),0===s.length?(0,o.jsx)("p",{children:"Aucune t\xe2che trouv\xe9e dans ce projet."}):(0,o.jsx)("div",{className:"tasks-list",children:s.map((e=>(0,o.jsxs)("div",{className:"task-item",children:[(0,o.jsxs)("div",{className:"task-header",children:[(0,o.jsx)("div",{className:"task-title-section",onClick:()=>l&&l(e),children:(0,o.jsx)("h5",{children:e.title})}),(0,o.jsxs)("div",{className:"task-header-right",children:[(0,o.jsx)("span",{className:"priority priority-".concat(e.priority||"medium"),children:e.priority||"medium"}),(0,o.jsx)("button",{className:"btn-toggle-actions",onClick:s=>{s.stopPropagation(),(e=>{const s=new Set(m);s.has(e)?s.delete(e):s.add(e),u(s)})(e.id)},title:"Afficher/Masquer les actions",children:m.has(e.id)?"\u2212":"+"})]})]}),(0,o.jsx)("p",{className:"task-description",children:e.description||"Aucune description"}),(0,o.jsxs)("div",{className:"task-meta",children:[(0,o.jsxs)("span",{className:"assigned-to",children:["Assign\xe9e \xe0: ",e.assignedTo?"object"===typeof e.assignedTo?"".concat(e.assignedTo.firstname," ").concat(e.assignedTo.lastname):e.assignedTo:"En attente d'assignation"]}),(0,o.jsxs)("span",{className:"created-at",children:["Cr\xe9\xe9e le: ",new Date(e.createdAt).toLocaleDateString("fr-FR")]}),(0,o.jsxs)("span",{className:"estimated-hours",children:["Heures estim\xe9es: ",e.estimatedHours||1,"h"]}),(0,o.jsxs)("span",{className:"task-level",children:["Niveau: ",e.level||"intermediate"]})]}),(0,o.jsxs)("div",{className:"task-actions ".concat(m.has(e.id)?"expanded":"collapsed"),children:[(0,o.jsx)("button",{className:"btn-view",onClick:s=>{s.stopPropagation(),l&&l(e)},title:"Voir les d\xe9tails de cette t\xe2che",children:"Voir"}),c.A.canModifyTasks(d)&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("button",{className:"btn-edit",onClick:s=>{s.stopPropagation(),r&&r(e)},title:"Modifier cette t\xe2che",children:"Modifier"}),(0,o.jsx)("button",{className:"btn-reassign",onClick:s=>{s.stopPropagation(),i(e)},title:"R\xe9assigner cette t\xe2che",children:"R\xe9assigner"}),(0,o.jsx)("button",{className:"btn-delete",onClick:s=>{s.stopPropagation(),window.confirm("\xcates-vous s\xfbr de vouloir supprimer cette t\xe2che ?")&&n&&n(e.id)},title:"Supprimer cette t\xe2che",children:"Supprimer"})]})]})]},e.id)))})]})]})},h=e=>{let{isOpen:s,onClose:a,user:i,projectId:r,projectUsers:l,projectTasks:c,onUserUpdated:d}=e;const[m,u]=(0,t.useState)(i.role),[h,j]=(0,t.useState)(!1),[p,x]=(0,t.useState)(""),[v,g]=(0,t.useState)(""),N=c.filter((e=>e.assignedTo&&("object"===typeof e.assignedTo?e.assignedTo.id===i.id:e.assignedTo===i.id)));return s?(0,o.jsx)("div",{className:"modal-overlay",children:(0,o.jsxs)("div",{className:"modal-content user-profile-modal",children:[(0,o.jsxs)("div",{className:"modal-header",children:[(0,o.jsxs)("h2",{children:["Profil de ",i.firstname," ",i.lastname]}),(0,o.jsx)("button",{className:"modal-close",onClick:a,children:"\xd7"})]}),(0,o.jsxs)("div",{className:"user-profile-content",children:[(0,o.jsxs)("div",{className:"user-info-section",children:[(0,o.jsxs)("div",{className:"user-basic-info",children:[(0,o.jsx)("h3",{children:"Informations personnelles"}),(0,o.jsxs)("div",{className:"info-grid",children:[(0,o.jsxs)("div",{className:"info-item",children:[(0,o.jsx)("label",{children:"Nom complet:"}),(0,o.jsxs)("span",{children:[i.firstname," ",i.lastname]})]}),(0,o.jsxs)("div",{className:"info-item",children:[(0,o.jsx)("label",{children:"Email:"}),(0,o.jsx)("span",{children:i.email})]}),(0,o.jsxs)("div",{className:"info-item",children:[(0,o.jsx)("label",{children:"R\xf4le actuel:"}),(0,o.jsx)("span",{className:"role-badge role-".concat(i.role),children:(e=>{switch(e){case"responsable_projet":return"Responsable de Projet";case"manager":return"Manager";case"collaborateur":return"Collaborateur";default:return e}})(i.role)})]}),(0,o.jsxs)("div",{className:"info-item",children:[(0,o.jsx)("label",{children:"Date d'adh\xe9sion:"}),(0,o.jsx)("span",{children:new Date(i.joinedAt).toLocaleDateString("fr-FR")})]})]})]}),(0,o.jsxs)("div",{className:"user-role-management",children:[(0,o.jsx)("h3",{children:"Gestion du r\xf4le"}),(0,o.jsxs)("div",{className:"role-selector",children:[(0,o.jsx)("label",{htmlFor:"role-select",children:"Changer le r\xf4le:"}),(0,o.jsxs)("select",{id:"role-select",value:m,onChange:e=>u(e.target.value),disabled:h,children:[(0,o.jsx)("option",{value:"collaborateur",children:"Collaborateur"}),(0,o.jsx)("option",{value:"manager",children:"Manager"}),(0,o.jsx)("option",{value:"responsable_projet",children:"Responsable de Projet"})]}),(0,o.jsx)("button",{className:"btn-primary",onClick:async()=>{if(m!==i.role){j(!0),x(""),g("");try{const e=await n.dashboardServices.updateUserRole(r,i.id,m);e.success?(g("R\xf4le mis \xe0 jour avec succ\xe8s"),d()):x(e.error||"Erreur lors de la mise \xe0 jour du r\xf4le")}catch(e){x(e.message||"Erreur lors de la mise \xe0 jour du r\xf4le")}finally{j(!1)}}},disabled:h||m===i.role,children:h?"Mise \xe0 jour...":"Mettre \xe0 jour le r\xf4le"})]})]})]}),(0,o.jsxs)("div",{className:"user-skills-section",children:[(0,o.jsx)("h3",{children:"Comp\xe9tences"}),(0,o.jsx)("div",{className:"skills-list",children:i.skills&&i.skills.length>0?i.skills.map((e=>(0,o.jsx)("span",{className:"skill-tag",children:e.name},e.id))):(0,o.jsx)("p",{className:"no-skills",children:"Aucune comp\xe9tence d\xe9finie"})})]}),(0,o.jsxs)("div",{className:"user-tasks-section",children:[(0,o.jsxs)("h3",{children:["T\xe2ches assign\xe9es (",N.length,")"]}),0===N.length?(0,o.jsx)("p",{className:"no-tasks",children:"Aucune t\xe2che assign\xe9e"}):(0,o.jsx)("div",{className:"tasks-list",children:N.map((e=>(0,o.jsxs)("div",{className:"task-item",children:[(0,o.jsxs)("div",{className:"task-header",children:[(0,o.jsx)("h4",{children:e.title}),(0,o.jsx)("span",{className:"priority priority-".concat(e.priority),children:e.priority})]}),(0,o.jsx)("p",{className:"task-description",children:e.description||"Aucune description"}),(0,o.jsxs)("div",{className:"task-meta",children:[(0,o.jsxs)("span",{className:"task-status",children:["Statut: ",e.status]}),(0,o.jsxs)("span",{className:"task-created",children:["Cr\xe9\xe9e le: ",new Date(e.createdAt).toLocaleDateString("fr-FR")]})]}),(0,o.jsx)("div",{className:"task-actions",children:(0,o.jsx)("button",{className:"btn-danger btn-small",onClick:()=>(async e=>{if(window.confirm("\xcates-vous s\xfbr de vouloir supprimer cette t\xe2che ?")){j(!0),x("");try{const s=await n.dashboardServices.deleteTask(e);s.success?(g("T\xe2che supprim\xe9e avec succ\xe8s"),d()):x(s.error||"Erreur lors de la suppression de la t\xe2che")}catch(s){x(s.message||"Erreur lors de la suppression de la t\xe2che")}finally{j(!1)}}})(e.id),disabled:h,title:"Supprimer cette t\xe2che",children:"\ud83d\uddd1\ufe0f Supprimer"})})]},e.id)))})]}),(0,o.jsxs)("div",{className:"user-stats-section",children:[(0,o.jsx)("h3",{children:"Statistiques"}),(0,o.jsxs)("div",{className:"stats-grid",children:[(0,o.jsxs)("div",{className:"stat-item",children:[(0,o.jsx)("span",{className:"stat-number",children:N.length}),(0,o.jsx)("span",{className:"stat-label",children:"T\xe2ches assign\xe9es"})]}),(0,o.jsxs)("div",{className:"stat-item",children:[(0,o.jsx)("span",{className:"stat-number",children:N.filter((e=>"completed"===e.status)).length}),(0,o.jsx)("span",{className:"stat-label",children:"T\xe2ches termin\xe9es"})]}),(0,o.jsxs)("div",{className:"stat-item",children:[(0,o.jsx)("span",{className:"stat-number",children:i.skills?i.skills.length:0}),(0,o.jsx)("span",{className:"stat-label",children:"Comp\xe9tences"})]})]})]})]}),p&&(0,o.jsx)("div",{className:"error-message",children:p}),v&&(0,o.jsx)("div",{className:"success-message",children:v}),(0,o.jsx)("div",{className:"modal-footer",children:(0,o.jsx)("button",{type:"button",className:"btn-secondary",onClick:a,children:"Fermer"})})]})}):null},j=e=>{let{currentHours:s,maxHours:a,user:t}=e;const i=a>0?s/a*100:0;let r="#10B981";return i>=90?r="#EF4444":i>=75?r="#F59E0B":i>=50&&(r="#3B82F6"),(0,o.jsxs)("div",{className:"workload-bar-container",children:[(0,o.jsxs)("div",{className:"workload-info",children:[(0,o.jsxs)("span",{className:"user-name",children:[t.firstname," ",t.lastname]}),(0,o.jsxs)("span",{className:"workload-hours",children:[s,"h / ",a,"h"]})]}),(0,o.jsx)("div",{className:"workload-bar",children:(0,o.jsx)("div",{className:"workload-fill",style:{width:"".concat(Math.min(i,100),"%"),backgroundColor:r}})}),(0,o.jsxs)("div",{className:"workload-percentage",children:[i.toFixed(1),"%"]})]})},p=e=>{let{projectUsers:s,projectTasks:a,onAddUser:i,onUserUpdated:r,selectedProject:l,currentUserRole:n}=e;const[d,m]=(0,t.useState)(null),[u,p]=(0,t.useState)(!1),x=e=>{if(!e)return"Non d\xe9fini";const s="string"===typeof e?e:String(e);switch(s){case"Responsable de Projet":case"responsable_projet":return"Responsable de Projet";case"Manager":case"manager":return"Manager";case"Collaborateur":case"collaborateur":return"Collaborateur";default:return s}};return(0,o.jsxs)("div",{className:"users-tab",children:[(0,o.jsxs)("div",{className:"tab-header",children:[(0,o.jsx)("h3",{children:"Gestion des Utilisateurs"}),(0,o.jsxs)("div",{className:"tab-actions",children:[c.A.canManageUsers(n)&&(0,o.jsx)("button",{className:"btn-primary",onClick:i,children:"+ Ajouter un utilisateur"}),c.A.isManager(n)&&(0,o.jsx)("div",{className:"manager-info",children:(0,o.jsx)("span",{className:"info-text",children:"Mode consultation uniquement"})})]})]}),(0,o.jsxs)("div",{className:"project-users-detailed",children:[(0,o.jsx)("h4",{children:"Utilisateurs du projet"}),0===s.length?(0,o.jsx)("p",{children:"Aucun utilisateur trouv\xe9 dans ce projet."}):(0,o.jsx)("div",{className:"users-detailed-list",children:s.map((e=>{return(0,o.jsxs)("div",{className:"user-detailed-item ".concat(c.A.canManageUsers(n)?"clickable":"readonly"),onClick:c.A.canManageUsers(n)?()=>{m(e),p(!0)}:void 0,title:c.A.canManageUsers(n)?"Cliquer pour voir le profil d\xe9taill\xe9":"Mode consultation uniquement - Modification non autoris\xe9e",children:[(0,o.jsxs)("div",{className:"user-header",children:[(0,o.jsxs)("div",{className:"user-info",children:[(0,o.jsxs)("strong",{children:[e.firstname," ",e.lastname]}),(0,o.jsx)("span",{className:"user-email",children:e.email})]}),(0,o.jsx)("span",{className:"user-role role-".concat(e.role),children:x(e.role)})]}),(0,o.jsxs)("div",{className:"user-details",children:[(0,o.jsxs)("div",{className:"user-section",children:[(0,o.jsx)("h5",{children:"T\xe2ches assign\xe9es"}),(0,o.jsx)("div",{className:"user-tasks",children:0===a.filter((s=>s.assignedTo&&("object"===typeof s.assignedTo?s.assignedTo.id===e.id:s.assignedTo===e.id))).length?(0,o.jsx)("p",{className:"no-tasks",children:"Aucune t\xe2che assign\xe9e"}):a.filter((s=>s.assignedTo&&("object"===typeof s.assignedTo?s.assignedTo.id===e.id:s.assignedTo===e.id))).map((e=>(0,o.jsxs)("div",{className:"user-task-item",children:[(0,o.jsx)("span",{className:"task-title",children:e.title}),(0,o.jsx)("span",{className:"task-priority priority-".concat(e.priority),children:e.priority}),(0,o.jsx)("span",{className:"task-status",children:e.status})]},e.id)))})]}),(0,o.jsxs)("div",{className:"user-section",children:[(0,o.jsx)("h5",{children:"Comp\xe9tences"}),(0,o.jsx)("div",{className:"user-skills",children:e.skills&&e.skills.length>0?e.skills.map((e=>(0,o.jsx)("span",{className:"skill-tag",children:e.name},e.id))):(0,o.jsx)("p",{className:"no-skills",children:"Aucune comp\xe9tence d\xe9finie"})})]}),(0,o.jsxs)("div",{className:"user-section",children:[(0,o.jsx)("h5",{children:"Charge de travail"}),(0,o.jsx)(j,{currentHours:(s=e.id,a.filter((e=>e.assignedTo&&("object"===typeof e.assignedTo?e.assignedTo.id===s:e.assignedTo===s))).reduce(((e,s)=>e+(s.estimatedHours||1)),0)),maxHours:e.maxWorkloadHours||40,user:e})]}),(0,o.jsxs)("div",{className:"user-section",children:[(0,o.jsx)("h5",{children:"Statistiques"}),(0,o.jsxs)("div",{className:"user-stats",children:[(0,o.jsxs)("div",{className:"stat-item",children:[(0,o.jsx)("span",{className:"stat-number",children:a.filter((s=>s.assignedTo&&("object"===typeof s.assignedTo?s.assignedTo.id===e.id:s.assignedTo===e.id))).length}),(0,o.jsx)("span",{className:"stat-label",children:"T\xe2ches"})]}),(0,o.jsxs)("div",{className:"stat-item",children:[(0,o.jsx)("span",{className:"stat-number",children:e.skills?e.skills.length:0}),(0,o.jsx)("span",{className:"stat-label",children:"Comp\xe9tences"})]})]})]})]})]},e.id);var s}))})]}),u&&d&&l&&(0,o.jsx)(h,{isOpen:u,onClose:()=>{p(!1),m(null)},user:d,projectId:l.id,projectUsers:s,projectTasks:a,onUserUpdated:r})]})},x=e=>{let{activeTab:s,setActiveTab:a,projectTasks:t,projectUsers:i,onCreateTask:r,onEditTask:l,onShowTaskDetail:n,onReassignTask:c,onDeleteTask:d,onAddUser:h,onUserUpdated:j,onNavigateToDashboard:x,selectedProject:v,currentUserRole:g}=e;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:"admin-tabs",children:[(0,o.jsx)("button",{className:"tab-button ".concat("overview"===s?"active":""),onClick:()=>a("overview"),children:"Vue d'ensemble"}),(0,o.jsx)("button",{className:"tab-button ".concat("tasks"===s?"active":""),onClick:()=>a("tasks"),children:"Gestion des T\xe2ches"}),(0,o.jsx)("button",{className:"tab-button ".concat("users"===s?"active":""),onClick:()=>a("users"),children:"Gestion des Utilisateurs"})]}),(0,o.jsxs)("div",{className:"tab-content",children:["overview"===s&&(0,o.jsx)(m,{projectTasks:t,projectUsers:i,onCreateTask:r,onAddUser:h,onNavigateToDashboard:x,currentUserRole:g}),"tasks"===s&&(0,o.jsx)(u,{projectTasks:t,onCreateTask:r,onEditTask:l,onShowTaskDetail:n,onReassignTask:c,onDeleteTask:d,currentUserRole:g}),"users"===s&&(0,o.jsx)(p,{projectUsers:i,projectTasks:t,onAddUser:h,onUserUpdated:j,selectedProject:v,currentUserRole:g})]})]})};var v=a(987),g=a(367),N=a(555);const k=e=>{let{isOpen:s,onClose:a,projectId:i,onUserAdded:r}=e;const[l,c]=(0,t.useState)({email:"",role:"",message:""}),[d,m]=(0,t.useState)(!1),[u,h]=(0,t.useState)("");return s?(0,o.jsx)("div",{className:"modal-overlay",children:(0,o.jsxs)("div",{className:"modal-content add-user-modal",children:[(0,o.jsxs)("div",{className:"modal-header",children:[(0,o.jsx)("h2",{children:"Ajouter un utilisateur au projet"}),(0,o.jsx)("button",{className:"modal-close",onClick:a,children:"\xd7"})]}),(0,o.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),l.email&&l.role){m(!0),h("");try{const e=await n.dashboardServices.addUserToProject(i,l.email,l.role);e.success?(r(),c({email:"",role:"",message:""})):h(e.error||"Erreur lors de l'ajout de l'utilisateur")}catch(s){h(s.message||"Erreur lors de l'ajout de l'utilisateur")}finally{m(!1)}}else h("Email et r\xf4le sont requis")},className:"add-user-form",children:[(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{htmlFor:"email",children:"Email de l'utilisateur *"}),(0,o.jsx)("input",{type:"email",id:"email",value:l.email,onChange:e=>c((0,N.A)((0,N.A)({},l),{},{email:e.target.value})),placeholder:"exemple@email.com",required:!0})]}),(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{htmlFor:"role",children:"R\xf4le dans le projet *"}),(0,o.jsxs)("select",{id:"role",value:l.role,onChange:e=>c((0,N.A)((0,N.A)({},l),{},{role:e.target.value})),required:!0,children:[(0,o.jsx)("option",{value:"",children:"S\xe9lectionner un r\xf4le"}),(0,o.jsx)("option",{value:"collaborateur",children:"Collaborateur"}),(0,o.jsx)("option",{value:"manager",children:"Manager"}),(0,o.jsx)("option",{value:"responsable_projet",children:"Responsable de Projet"})]})]}),(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{htmlFor:"message",children:"Message d'invitation (optionnel)"}),(0,o.jsx)("textarea",{id:"message",value:l.message,onChange:e=>c((0,N.A)((0,N.A)({},l),{},{message:e.target.value})),placeholder:"Message personnalis\xe9 pour l'invitation...",rows:"3"})]}),u&&(0,o.jsx)("div",{className:"error-message",children:u}),(0,o.jsxs)("div",{className:"modal-footer",children:[(0,o.jsx)("button",{type:"button",className:"btn-secondary",onClick:a,children:"Annuler"}),(0,o.jsx)("button",{type:"submit",className:"btn-primary",disabled:d,children:d?"Ajout...":"Ajouter l'utilisateur"})]})]})]})}):null},b=e=>{let{isOpen:s,onClose:a,task:i,projectUsers:r,projectTasks:l,onTaskReassigned:c}=e;const[d,m]=(0,t.useState)(null),[u,h]=(0,t.useState)(!1),[j,p]=(0,t.useState)("");return s?(0,o.jsx)("div",{className:"modal-overlay",children:(0,o.jsxs)("div",{className:"modal-content reassign-modal",children:[(0,o.jsxs)("div",{className:"modal-header",children:[(0,o.jsx)("h2",{children:"R\xe9assigner la t\xe2che"}),(0,o.jsx)("button",{className:"modal-close",onClick:a,children:"\xd7"})]}),(0,o.jsxs)("div",{className:"task-info",children:[(0,o.jsx)("h3",{children:i.title}),(0,o.jsxs)("p",{children:[(0,o.jsx)("strong",{children:"Actuellement assign\xe9e \xe0 :"})," ",i.assignedTo?"object"===typeof i.assignedTo?"".concat(i.assignedTo.firstname," ").concat(i.assignedTo.lastname):i.assignedTo:"Personne"]})]}),(0,o.jsxs)("div",{className:"reassign-section",children:[(0,o.jsx)("h4",{children:"Choisir un nouvel assign\xe9 :"}),(0,o.jsx)("div",{className:"users-list",children:r.filter((e=>"collaborateur"===e.role||"Collaborateur"===e.role)).map((e=>(0,o.jsxs)("div",{className:"user-option ".concat(d&&d.id===e.id?"selected":""," ").concat(i.assignedTo&&("object"===typeof i.assignedTo?i.assignedTo.id===e.id:i.assignedTo===e.id)?"currently-assigned":""),onClick:()=>(e=>{m(e)})(e),children:[(0,o.jsxs)("div",{className:"user-info",children:[(0,o.jsxs)("strong",{children:[e.firstname," ",e.lastname]}),(0,o.jsx)("span",{className:"user-email",children:e.email}),d&&d.id===e.id&&(0,o.jsx)("span",{className:"selection-indicator",children:"\u2705 S\xe9lectionn\xe9"})]}),(0,o.jsx)("div",{className:"user-skills",children:e.skills&&e.skills.length>0?e.skills.map((e=>(0,o.jsx)("span",{className:"skill-tag",children:e.name},e.id))):(0,o.jsx)("span",{className:"no-skills",children:"Aucune comp\xe9tence"})}),(0,o.jsxs)("div",{className:"user-workload",children:[(0,o.jsx)("span",{className:"workload-label",children:"T\xe2ches actuelles :"}),(0,o.jsx)("span",{className:"workload-number",children:l.filter((s=>s.assignedTo&&("object"===typeof s.assignedTo?s.assignedTo.id===e.id:s.assignedTo===e.id))).length})]})]},e.id)))})]}),j&&(0,o.jsx)("div",{className:"error-message",children:j}),(0,o.jsxs)("div",{className:"modal-footer",children:[(0,o.jsx)("button",{type:"button",className:"btn-secondary",onClick:a,children:"Annuler"}),(0,o.jsx)("button",{type:"button",className:"btn-primary",onClick:async()=>{if(d){h(!0),p("");try{(await n.dashboardServices.updateTask(i.id,{assignedTo:d.id})).success?c():p("Erreur lors de la r\xe9assignation")}catch(e){p(e.message||"Erreur lors de la r\xe9assignation")}finally{h(!1)}}},disabled:!d||u,children:u?"R\xe9assignation...":"Confirmer la r\xe9assignation"})]})]})}):null},f=()=>{const[e,s]=(0,t.useState)([]),[a,m]=(0,t.useState)(!0),[u,h]=(0,t.useState)(null),[j,p]=(0,t.useState)(null),[N,f]=(0,t.useState)(null),[T,S]=(0,t.useState)("overview"),[y,A]=(0,t.useState)([]),[C,w]=(0,t.useState)([]),[U,P]=(0,t.useState)(!1),[R,E]=(0,t.useState)(!1),[M,D]=(0,t.useState)(null),[F,I]=(0,t.useState)(!1),[O,q]=(0,t.useState)(null),[H,G]=(0,t.useState)(!1),[_,V]=(0,t.useState)(null),[B,J]=(0,t.useState)(!1),L=(0,i.Zp)();(0,t.useEffect)((()=>{(async()=>{await c.A.isAuthenticated()?await Q():L("/login")})()}),[L]);const[z,W]=(0,t.useState)(null),[Z,K]=(0,t.useState)([]);(0,t.useEffect)((()=>{if(e.length>0&&j){if(!c.A.canAccessAdminGlobally(e,j.id))return h("Acc\xe8s refus\xe9 : Vous devez \xeatre manager ou responsable de projet sur au moins un projet pour acc\xe9der \xe0 la section Admin."),void m(!1);const s=c.A.getAdminAccessibleProjects(e,j.id);K(s),s.length>0&&!N&&f(s[0])}}),[e,j,N]),(0,t.useEffect)((()=>{if(N&&j){const e=c.A.getUserRoleInProject(N,j.id);W(e)}}),[N,j]),(0,t.useEffect)((()=>{N&&X(N.id)}),[N]);const Q=async()=>{try{var e;m(!0);const[t,i]=await Promise.all([n.dashboardServices.getProjects(),n.dashboardServices.getProfile()]);s(t.projects||[]),p(i.user||i);const r=localStorage.getItem("adminSelectedProject");if(r){var a;const e=JSON.parse(r);(null===(a=t.projects)||void 0===a?void 0:a.find((s=>s.id===e.id)))&&f(e)}if(!localStorage.getItem("adminSelectedProject")&&(null===(e=t.projects)||void 0===e?void 0:e.length)>0){const e=t.projects[0];f(e),localStorage.setItem("adminSelectedProject",JSON.stringify(e))}}catch(t){h(t.message)}finally{m(!1)}},X=async e=>{try{const s=await n.dashboardServices.getTasks(e);if(s&&s.tasks){const e=s.tasks.map((e=>({id:e.id||0,title:e.title||"Sans titre",description:e.description||"",priority:e.priority||"medium",level:e.level||"intermediate",estimatedHours:e.estimatedHours||1,assignedTo:e.assignedTo||null,requiredSkills:e.requiredSkills||[],createdAt:e.createdAt||(new Date).toISOString()}))).sort(((e,s)=>new Date(s.createdAt)-new Date(e.createdAt)));A(e)}const a=await n.dashboardServices.getProjectUsers(e);if(a&&a.users){const e=a.users.map((e=>({id:e.id||0,firstname:e.firstname||"",lastname:e.lastname||"",email:e.email||"",role:e.role||"collaborateur",skills:e.skills||[]})));w(e)}}catch(s){console.error("Error fetching project data:",s)}},Y=async()=>{E(!1),D(null),N&&await X(N.id)};return a?(0,o.jsxs)("div",{className:"admin-container",children:[(0,o.jsx)(r.A,{}),(0,o.jsxs)("div",{className:"admin-content",children:[(0,o.jsx)("div",{className:"loading-spinner"}),(0,o.jsx)("p",{children:"Chargement..."})]}),(0,o.jsx)(l.A,{})]}):u?(0,o.jsxs)("div",{className:"admin-container",children:[(0,o.jsx)(r.A,{}),(0,o.jsx)("div",{className:"admin-content",children:(0,o.jsxs)("div",{className:"error-message",children:[(0,o.jsxs)("p",{children:["Erreur: ",u]}),u.includes("Acc\xe8s refus\xe9")?(0,o.jsx)("p",{className:"error-redirect",children:"Redirection vers le tableau de bord dans 3 secondes..."}):(0,o.jsx)("button",{onClick:Q,children:"R\xe9essayer"})]})}),(0,o.jsx)(l.A,{})]}):(0,o.jsxs)("div",{className:"admin-container",children:[(0,o.jsx)(r.A,{}),(0,o.jsxs)("div",{className:"admin-content",children:[(0,o.jsx)(d,{projects:Z,selectedProject:N,onProjectChange:s=>{if(s){const a=e.find((e=>e.id===s));a&&(f(a),localStorage.setItem("adminSelectedProject",JSON.stringify(a)))}else f(null),localStorage.removeItem("adminSelectedProject");S("overview")}}),N?(0,o.jsx)(x,{activeTab:T,setActiveTab:S,projectTasks:y,projectUsers:C,selectedProject:N,currentUserRole:z,onCreateTask:()=>{P(!0)},onEditTask:e=>{D(e),E(!0)},onShowTaskDetail:e=>{q(e),I(!0)},onReassignTask:e=>{V(e),G(!0)},onDeleteTask:async e=>{try{await n.dashboardServices.deleteTask(e),N&&await X(N.id)}catch(s){h(s.message)}},onAddUser:()=>{J(!0)},onUserUpdated:async()=>{N&&await X(N.id)},onNavigateToDashboard:()=>L("/dashboard?project=".concat(N))}):(0,o.jsxs)("div",{className:"no-project-selected",children:[(0,o.jsx)("h2",{children:"Aucun projet accessible"}),(0,o.jsx)("p",{children:"Vous devez \xeatre manager ou responsable de projet pour acc\xe9der \xe0 l'administration."})]})]}),(0,o.jsx)(l.A,{}),U&&N&&(0,o.jsx)(v.A,{isOpen:U,onClose:()=>P(!1),projectId:N.id,onTaskCreated:async()=>{P(!1),N&&await X(N.id)},projectUsers:C,projectTasks:y,autoAssign:!0}),B&&N&&(0,o.jsx)(k,{isOpen:B,onClose:()=>J(!1),projectId:N.id,onUserAdded:async()=>{J(!1),N&&await X(N.id)}}),H&&_&&(0,o.jsx)(b,{isOpen:H,onClose:()=>G(!1),task:_,projectUsers:C,projectTasks:y,onTaskReassigned:async()=>{G(!1),V(null),N&&await X(N.id)}}),R&&M&&N&&(0,o.jsx)(g.A,{isOpen:R,onClose:()=>{E(!1),D(null)},onTaskUpdate:async(e,s)=>{try{await n.dashboardServices.updateTask(e,s),await Y()}catch(a){console.error("Erreur lors de la mise \xe0 jour de la t\xe2che:",a)}},task:M,project:N,mode:"edit"}),F&&O&&N&&(0,o.jsx)(g.A,{isOpen:F,onClose:()=>{I(!1),q(null)},onTaskUpdate:async(e,s)=>{try{await n.dashboardServices.updateTask(e,s),await Y()}catch(a){console.error("Erreur lors de la mise \xe0 jour de la t\xe2che:",a)}},task:O,project:N,mode:"view"})]})}}}]);
//# sourceMappingURL=585.9c8c469a.chunk.js.map